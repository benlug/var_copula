{
  "hash": "7a17a562d0c9f0384634f378bc90d260",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Study 3: VAR(1) with Normal Margins — Gaussian vs. Clayton Copula\"\nformat:\n  pdf:\n    toc: true\n    toc_depth: 3\nexecute:\n  warning: false\n  message: false\n---\n\n::: {.cell}\n\n:::\n\n\n\n# 0. Summary\n\n## 0.1 Computational Stability\n\nBoth models exhibit excellent computational stability across all simulation conditions. The Normal–Gaussian (NG) model and the Normal–Clayton (NC) model both show no post-warmup divergent transitions and max $\\hat{R} \\leq 1.01$ in all replications. This stands in contrast to Studies 1–2 where some model-DGP combinations exhibited divergences.\n\n## 0.2 Model Performance Under Clayton Copula DGP\n\n**Normal–Clayton (NC):** The correctly specified model is approximately unbiased for all parameters including the copula parameter $\\theta$. Coverage is close to nominal (0.95) across conditions, with slight under-coverage for $\\theta$ at higher dependence levels ($\\theta \\geq 4$) in small samples.\n\n**Normal–Gaussian (NG):** The misspecified model recovers the VAR dynamics ($\\Phi$) and intercepts ($\\mu$) without substantial bias, demonstrating robustness of marginal parameter inference to copula misspecification. The copula parameter $\\rho$ has no ground truth under the Clayton DGP, but posterior means increase monotonically with $\\theta$, indicating the Gaussian copula \"absorbs\" the Clayton dependence structure.\n\n## 0.3 Key Insights\n\n1. **Copula misspecification does not propagate to marginal parameters**: Under normal margins, the NG model recovers $\\mu$, $\\Phi$, and $\\sigma$ with similar accuracy to the correctly specified NC model.\n\n2. **The Clayton copula captures asymmetric tail dependence**: Unlike the symmetric Gaussian copula, the Clayton copula concentrates dependence in the lower tail. This feature cannot be captured by the NG model's $\\rho$ parameter.\n\n3. **Kendall's $\\tau$ provides a common dependence scale**: The relationship $\\tau = \\theta/(\\theta+2)$ maps Clayton $\\theta$ to the $[0,1]$ scale, facilitating comparison with Gaussian $\\rho$ (where $\\tau = (2/\\pi)\\arcsin(\\rho)$).\n\n# 1. Introduction\n\nThis simulation study compares two Bayesian VAR(1) models under a Clayton copula DGP with normal margins: a Normal–Gaussian (NG) model (misspecified copula) and a Normal–Clayton (NC) model (correctly specified). Unlike Studies 1–2, which examined marginal distribution misspecification, Study 3 focuses on **copula misspecification** while keeping margins correctly specified in both models.\n\n## 1.1. Data Generating Process (DGP)\n\nThe DGP follows the same VAR(1) structure as Studies 1–2:\n\n$$\nY_t = \\mu + \\Phi Y_{t-1} + \\varepsilon_t, \\qquad t = 2, \\ldots, T,\n$$\n\nwith $\\mu = \\mathbf{0}$. Innovations $\\varepsilon_t = (\\varepsilon_{1t}, \\varepsilon_{2t})$ have standard normal margins (mean 0, variance 1) coupled through a **Clayton copula** with parameter $\\theta > 0$.\n\n::: {.callout-note}\n## Clayton Copula\n\nThe Clayton copula is an Archimedean copula with CDF:\n\n$$\nC(u, v; \\theta) = \\left(u^{-\\theta} + v^{-\\theta} - 1\\right)^{-1/\\theta}, \\qquad \\theta > 0\n$$\n\nIt exhibits **lower-tail dependence**: extreme low values co-occur more frequently than under a Gaussian copula. The lower-tail dependence coefficient is $\\lambda_L = 2^{-1/\\theta}$.\n:::\n\n::: {.callout-important}\n## Kendall's Tau Relationship\n\nFor the Clayton copula, Kendall's $\\tau$ relates to $\\theta$ via:\n\n$$\n\\tau = \\frac{\\theta}{\\theta + 2}\n$$\n\nThis provides a monotone mapping between $\\theta \\in (0, \\infty)$ and $\\tau \\in (0, 1)$:\n\n| $\\theta$ | 0.5 | 1.0 | 2.0 | 4.0 | 8.0 |\n|----------|-----|-----|-----|-----|-----|\n| $\\tau$ | 0.20 | 0.33 | 0.50 | 0.67 | 0.80 |\n:::\n\n## 1.2. Simulation Design\n\nThe study employs a factorial design crossing three factors.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nTable: Summary of the Simulation Design Factors.\n\n|Factor                       |Levels                                                                |\n|:----------------------------|:---------------------------------------------------------------------|\n|Time Series Length (T)       |50, 100, 200                                                          |\n|Clayton Parameter ($\\theta$) |0.5, 1.0, 2.0, 4.0, 8.0                                               |\n|VAR Parameters ($\\Phi$)      |**Set A**: $\\begin{pmatrix} 0.40 & 0.10 \\\\ 0.10 & 0.40 \\end{pmatrix}$ |\n|                             |                                                                      |\n|Margins                      |Standard Normal (mean 0, variance 1)                                  |\n\n\n:::\n:::\n\n\n\n::: {.callout-note}\n## Design Simplification\n\nStudy 3 uses only VAR Set A (symmetric) and excludes skewness direction factors since all margins are symmetric normal. This yields $3 \\times 5 = 15$ conditions with 200 replications each, for a total of 3,000 simulated datasets.\n:::\n\n## 1.3. True Parameter Values\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nTable: True Parameter Values Used in the Data Generating Process.\n\n|Parameter              |True Value                          |Notes                             |\n|:----------------------|:-----------------------------------|:---------------------------------|\n|$\\mu_1, \\mu_2$         |0, 0                                |Innovations are mean-zero         |\n|$\\phi_{11}, \\phi_{22}$ |0.40                                |Diagonal AR coefficients          |\n|$\\phi_{12}, \\phi_{21}$ |0.10                                |Cross-effects (symmetric)         |\n|$\\sigma_1, \\sigma_2$   |1.0, 1.0                            |Innovations are unit-variance     |\n|$\\theta$ (NC model)    |Design value (0.5, 1, 2, 4, or 8)   |Clayton copula parameter          |\n|$\\rho$ (NG model)      |**Undefined** (copula misspecified) |No ground truth under Clayton DGP |\n\n\n:::\n:::\n\n\n\n::: {.callout-important}\n## No Ground Truth for $\\rho$ in NG Model\n\nUnder the Clayton copula DGP, the Gaussian copula parameter $\\rho$ has no well-defined ground truth. The NG model is misspecified for the copula structure, so bias and coverage metrics are **not computed** for $\\rho$. Instead, we report posterior means descriptively to show how the Gaussian copula absorbs Clayton dependence.\n:::\n\n## 1.4. Visual Check: Clayton Copula Dependence Structure\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](study_3_files/figure-pdf/dgp_copula_viz-1.pdf)\n:::\n:::\n\n\n\n**Interpretation.** The Clayton copula induces asymmetric dependence concentrated in the lower-left tail. As $\\theta$ increases, the clustering of extreme negative values becomes more pronounced. This lower-tail dependence cannot be captured by a symmetric Gaussian copula.\n\n# 2. Data Loading and Preparation\n\n\n\n::: {.cell}\n\n:::\n\n\n\n## 2.1. MCMC Classification and Overview\n\nWe classify runs based on MCMC diagnostics ($\\hat{R}$ and divergent transitions) using the same criteria as Studies 1–2:\n\n- **Clean**: $\\hat{R} \\leq 1.01$ and no post-warmup divergences.\n- **Problematic**: $\\hat{R} > 1.01$ or at least one divergence.\n- **Failed/Error**: Non-OK status or missing diagnostics.\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](study_3_files/figure-pdf/mcmc_status_plot-1.pdf)\n:::\n:::\n\n\n\n**Interpretation.** Both NG and NC fits are uniformly Clean across the entire design, with zero post-warmup divergent transitions. This excellent computational behavior demonstrates that both models sample efficiently under the Clayton DGP with normal margins.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nTable: Divergence summary: All runs have zero post-warmup divergent transitions.\n\n|Model                |T   | N Runs| Total Divergences|\n|:--------------------|:---|------:|-----------------:|\n|Normal–Gaussian (NG) |50  |   1000|                 0|\n|Normal–Gaussian (NG) |100 |   1000|                 0|\n|Normal–Gaussian (NG) |200 |   1000|                 0|\n|Normal–Clayton (NC)  |50  |   1000|                 0|\n|Normal–Clayton (NC)  |100 |   1000|                 0|\n|Normal–Clayton (NC)  |200 |   1000|                 0|\n\n\n:::\n:::\n\n\n\n# 3. Helper Functions\n\n\n\n::: {.cell}\n\n:::\n\n\n\n# 4. VAR Parameters: NG vs NC Performance\n\n## 4.1. Relative Bias\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](study_3_files/figure-pdf/var_bias_phi-1.pdf)\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](study_3_files/figure-pdf/var_bias_mu-1.pdf)\n:::\n:::\n\n\n\n**Interpretation.** Both models recover the VAR parameters with similar accuracy. The NG model (misspecified copula) shows no systematic bias disadvantage compared to NC, indicating that copula misspecification does not propagate to inference on the VAR dynamics.\n\n## 4.2. 95% Coverage\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](study_3_files/figure-pdf/var_coverage_phi-1.pdf)\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](study_3_files/figure-pdf/var_coverage_mu-1.pdf)\n:::\n:::\n\n\n\n**Interpretation.** Coverage is close to nominal for both models across all VAR parameters. There is no evidence that copula misspecification in NG degrades frequentist coverage for $\\mu$ or $\\Phi$.\n\n## 4.3. SD-Bias\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](study_3_files/figure-pdf/var_sdbias_phi-1.pdf)\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](study_3_files/figure-pdf/var_sdbias_mu-1.pdf)\n:::\n:::\n\n\n\n**Interpretation.** Both models show similar SD-bias patterns, with slight over-estimation of posterior uncertainty at smaller $T$. The patterns are nearly identical between NG and NC, further confirming that copula misspecification has minimal impact on VAR parameter inference.\n\n# 5. Copula Parameters\n\n## 5.1. NC (Clayton copula): $\\theta$ Recovery\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](study_3_files/figure-pdf/theta_bias-1.pdf)\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](study_3_files/figure-pdf/theta_coverage-1.pdf)\n:::\n:::\n\n\n\n**Interpretation.** The NC model shows negative bias for $\\theta$, with the magnitude increasing with $\\theta$. This suggests the prior (Log-Normal(0, 1)) may provide some shrinkage toward smaller values, particularly for $\\theta = 8$ which lies in the upper tail of the prior. Coverage is close to nominal for moderate $\\theta$ but drops below 0.95 for $\\theta = 8$ at small $T$, consistent with the bias pattern.\n\n## 5.2. NG (Gaussian copula): $\\rho$ Posterior Means\n\nSince $\\rho$ has no ground truth under the Clayton DGP, we report posterior means descriptively.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](study_3_files/figure-pdf/rho_postmean-1.pdf)\n:::\n:::\n\n\n\n**Interpretation.** The posterior mean of $\\rho$ increases monotonically with the true Clayton $\\theta$, showing how the Gaussian copula \"absorbs\" the Clayton dependence structure. For $\\theta = 8$ (Kendall's $\\tau = 0.80$), the NG model estimates $\\rho \\approx 0.85$, which corresponds to $\\tau_{\\text{Gauss}} = (2/\\pi)\\arcsin(0.85) \\approx 0.60$—lower than the true $\\tau = 0.80$ because the Gaussian copula cannot capture the asymmetric lower-tail dependence.\n\n# 6. Marginal Parameters\n\nWe report mean bias for the innovation standard deviations ($\\sigma$). Under the DGP, the true value is 1.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](study_3_files/figure-pdf/sigma_bias-1.pdf)\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](study_3_files/figure-pdf/sigma_coverage-1.pdf)\n:::\n:::\n\n\n\n**Interpretation.** Both models recover the marginal scale parameters with minimal bias and near-nominal coverage. As in Studies 1–2, the marginal parameters are robust to copula misspecification because they depend primarily on the univariate distribution of residuals, not their dependence structure.\n\n# 7. MCMC Diagnostics: Status Split\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](study_3_files/figure-pdf/coverage_status_nc-1.pdf)\n:::\n:::\n\n\n\n**Interpretation.** Since all replications are classified as Clean (no divergences, $\\hat{R} \\leq 1.01$), there is no variation by MCMC status. This confirms excellent computational behavior for both models.\n\n# 8. Export Tables\n\n\n\n::: {.cell}\n\n:::\n\n\n\nTables exported to results/exported_tables_s3:\n\n- `analysis_summary_aggregated.csv`: Condition-level metrics\n- `analysis_summary_status_split.csv`: Metrics split by MCMC status\n- `analysis_mcmc_health_counts.csv`: MCMC convergence counts\n\n# 9. Details\n\nThis section provides technical details on the implementation of the simulation study.\n\n## 9.1. Prior Specifications\n\n**Table: Prior Specifications for the Normal–Gaussian (NG) Model**\n\n| Parameter | Prior | Support | Rationale |\n|-----------|-------|---------|-----------|\n| $\\mu_1, \\mu_2$ | $\\text{Normal}(0, 1)$ | $\\mathbb{R}$ | Weakly informative; centered at true value (0) |\n| $\\phi_{11}, \\phi_{12}, \\phi_{21}, \\phi_{22}$ | $\\text{Normal}(0, 0.5)$ | $(-1, 1)$ | Regularizes toward stationarity |\n| $\\sigma_1, \\sigma_2$ | $\\text{Half-Normal}(0, 1)$ | $(0, \\infty)$ | Weakly informative scale prior |\n| $\\rho$ | $\\text{Normal}(0, 0.5)$ | $(-1, 1)$ | Regularizes toward independence |\n\n**Table: Prior Specifications for the Normal–Clayton (NC) Model**\n\n| Parameter | Prior | Support | Rationale |\n|-----------|-------|---------|-----------|\n| $\\mu_1, \\mu_2$ | $\\text{Normal}(0, 1)$ | $\\mathbb{R}$ | Weakly informative |\n| $\\phi_{11}, \\phi_{12}, \\phi_{21}, \\phi_{22}$ | $\\text{Normal}(0, 0.5)$ | $(-1, 1)$ | Regularizes toward stationarity |\n| $\\sigma_1, \\sigma_2$ | $\\text{Half-Normal}(0, 1)$ | $(0, \\infty)$ | Weakly informative scale prior |\n| $\\theta$ | $\\text{Log-Normal}(0, 1)$ | $(0, \\infty)$ | Covers design values within $\\pm 2$ SDs |\n\n::: {.callout-note}\n## Log-Normal Prior for Clayton $\\theta$\n\nThe Log-Normal(0, 1) prior has median 1 and places approximately 95% of its mass in $(0.14, 7.4)$. This covers the design grid $\\theta \\in \\{0.5, 1, 2, 4, 8\\}$ well, with only the largest value ($\\theta = 8$) lying slightly in the upper tail.\n:::\n\n## 9.2. MCMC Settings\n\n**Table: MCMC Sampling Configuration**\n\n| Setting | Value | Description |\n|---------|-------|-------------|\n| Chains | 4 | Number of independent Markov chains |\n| Total iterations | 3,000 | Iterations per chain (including warmup) |\n| Warmup iterations | 1,500 | Discarded adaptation period |\n| Post-warmup draws | 1,500 | Retained samples per chain |\n| `adapt_delta` | 0.98 | Target acceptance probability |\n| `max_treedepth` | 13 | Maximum tree depth for NUTS |\n| Parallelization | Outer loop | Replications parallelized; chains sequential |\n\n## 9.3. Gaussian Copula Log-Density\n\nFor uniform marginals $(u, v) \\in (0,1)^2$ with $\\rho \\in (-1, 1)$, let $z_1 = \\Phi^{-1}(u)$ and $z_2 = \\Phi^{-1}(v)$:\n\n$$\n\\log c_{\\text{Gauss}}(u, v; \\rho) = -\\frac{1}{2}\\log(1 - \\rho^2) - \\frac{1}{2(1-\\rho^2)}\\left(z_1^2 - 2\\rho z_1 z_2 + z_2^2\\right) + \\frac{1}{2}\\left(z_1^2 + z_2^2\\right)\n$$\n\n## 9.4. Clayton Copula Log-Density\n\nFor $(u, v) \\in (0,1)^2$ with $\\theta > 0$:\n\n$$\n\\log c_{\\text{Clayton}}(u, v; \\theta) = \\log(1 + \\theta) - (1+\\theta)\\bigl(\\log u + \\log v\\bigr) - \\left(2 + \\frac{1}{\\theta}\\right) \\log S\n$$\n\nwhere $S = u^{-\\theta} + v^{-\\theta} - 1$.\n\n::: {.callout-note}\n## Boundary Clamping\n\nBoth copula implementations apply boundary clamping with $\\varepsilon = 10^{-9}$:\n\n$$\nu_{\\text{clamped}} = \\max(\\varepsilon, \\min(1 - \\varepsilon, u))\n$$\n\nThis prevents numerical issues when $u \\to 0$ or $u \\to 1$.\n:::\n\n## 9.5. Reproducibility Strategy\n\nThe simulation uses deterministic seeding:\n\n- **Global seed**: 3033 (dedicated for Study 3)\n- **Init seeds**: $\\text{seed}_{\\text{init}} = 7 \\times 10^5 + \\text{cid} \\times 1000 + \\text{rid}$\n- **Stan seeds**: $\\text{seed}_{\\text{Stan}} = 8 \\times 10^5 + \\text{cid} \\times 1000 + \\text{rid}$\n\nResume capability is supported via `START_COND` and `START_REP` environment variables.\n\n## 9.6. Ground Truth Under Copula Misspecification\n\n| Parameter | NG Ground Truth | NC Ground Truth |\n|-----------|-----------------|-----------------|\n| $\\mu_1, \\mu_2$ | 0 | 0 |\n| $\\phi_{11}, \\phi_{22}$ | 0.40 | 0.40 |\n| $\\phi_{12}, \\phi_{21}$ | 0.10 | 0.10 |\n| $\\sigma_1, \\sigma_2$ | 1.0 | 1.0 |\n| $\\rho$ | **NA** (undefined) | — |\n| $\\theta$ | — | Design value |\n\nThe NG model's $\\rho$ has no ground truth because the Gaussian copula is misspecified for the Clayton DGP. Bias and coverage metrics are not computed for $\\rho$.\n",
    "supporting": [
      "study_3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}